<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å­¦ç¿’ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ  - èª²é¡Œæå‡º</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        .assignment-container {
            max-width: 800px;
            margin: 2rem auto;
            padding: 2rem;
            text-align: center;
        }

        .assignment-card {
            background: white;
            border-radius: 12px;
            padding: 3rem;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .assignment-icon {
            font-size: 4rem;
            margin-bottom: 1.5rem;
        }

        .assignment-title {
            font-size: 1.8rem;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 1rem;
        }

        .assignment-message {
            font-size: 1.1rem;
            color: #555;
            margin-bottom: 2rem;
            line-height: 1.6;
        }

        .loading-spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #007bff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 2rem auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error-message {
            color: #dc3545;
            margin-top: 1rem;
            padding: 1rem;
            background: #f8d7da;
            border-radius: 8px;
        }

        .back-button {
            display: inline-block;
            margin-top: 2rem;
            padding: 0.75rem 2rem;
            background: #6c757d;
            color: white;
            text-decoration: none;
            border-radius: 8px;
            transition: background 0.3s;
        }

        .back-button:hover {
            background: #5a6268;
        }
    </style>
</head>
<body>
    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <header class="header">
        <div class="logo"></div>
        <div class="user-info">
            <span class="user-name" id="userName">ãƒ¦ãƒ¼ã‚¶ãƒ¼</span>
            <button class="logout-btn" onclick="authSystem.logout()">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
        </div>
    </header>

    <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
    <main class="main-content">
        <div class="assignment-container">
            <div class="assignment-card">
                <div class="assignment-icon">ğŸ“</div>
                <h1 class="assignment-title">èª²é¡Œæå‡º</h1>
                <p class="assignment-message" id="assignmentMessage">
                    ã‚ãªãŸå°‚ç”¨ã®èª²é¡Œæå‡ºã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‚’é–‹ã„ã¦ã„ã¾ã™...<br>
                    <div class="loading-spinner"></div>
                </p>
                <div id="errorContainer"></div>
                <a href="home.html" class="back-button">ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹</a>
            </div>
        </div>
    </main>

    <!-- JavaScriptãƒ•ã‚¡ã‚¤ãƒ« -->
    <script src="js/config.js"></script>
    <script src="js/auth.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // èªè¨¼ãƒã‚§ãƒƒã‚¯
            if (!authSystem.requireAuth()) {
                return;
            }

            // ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã®è¡¨ç¤º
            const currentUser = authSystem.getCurrentUser();
            if (currentUser) {
                const userNameEl = document.getElementById('userName');
                if (userNameEl) {
                    userNameEl.textContent = currentUser.name;
                }

                // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆURLã‚’å–å¾—
                openAssignmentSpreadsheet(currentUser.userId);
            }
        });

        function openAssignmentSpreadsheet(userId) {
            // config.jsã«å®šç¾©ã•ã‚ŒãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆURLã‚’å–å¾—
            const assignmentUrl = CONFIG.USER_ASSIGNMENT_SHEETS[userId];

            if (assignmentUrl) {
                // ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‚’æ–°ã—ã„ã‚¿ãƒ–ã§é–‹ã
                const newWindow = window.open(assignmentUrl, '_blank');

                if (newWindow) {
                    // æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
                    document.getElementById('assignmentMessage').innerHTML = `
                        ã‚ãªãŸå°‚ç”¨ã®èª²é¡Œæå‡ºã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‚’é–‹ãã¾ã—ãŸã€‚<br>
                        æ–°ã—ã„ã‚¿ãƒ–ã§è¡¨ç¤ºã•ã‚Œãªã„å ´åˆã¯ã€ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ãƒ–ãƒ­ãƒƒã‚¯ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚
                    `;
                } else {
                    // ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ãŒãƒ–ãƒ­ãƒƒã‚¯ã•ã‚ŒãŸå ´åˆ
                    showError('ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ãŒãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œã¾ã—ãŸã€‚ä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‚’é–‹ã„ã¦ãã ã•ã„ã€‚', assignmentUrl);
                }
            } else {
                // ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆURLãŒè¦‹ã¤ã‹ã‚‰ãªã„å ´åˆ
                showError('ç”³ã—è¨³ã”ã–ã„ã¾ã›ã‚“ã€‚ã‚ãªãŸã®èª²é¡Œæå‡ºã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚ç®¡ç†è€…ã«ãŠå•ã„åˆã‚ã›ãã ã•ã„ã€‚');
            }
        }

        function showError(message, url = null) {
            const messageEl = document.getElementById('assignmentMessage');
            messageEl.innerHTML = message;

            if (url) {
                const errorContainer = document.getElementById('errorContainer');
                errorContainer.innerHTML = `
                    <div style="margin-top: 2rem;">
                        <a href="${url}" target="_blank" class="back-button" style="background: #007bff;">
                            ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‚’é–‹ã
                        </a>
                    </div>
                `;
            }
        }
    </script>
</body>
</html>
