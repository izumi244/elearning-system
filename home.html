<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å­¦ç¿’ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ  - ãƒ›ãƒ¼ãƒ </title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <header class="header">
        <div class="logo"></div>
        <div class="user-info">
            <span class="user-name" id="userName">ãƒ¦ãƒ¼ã‚¶ãƒ¼</span>
            <button class="logout-btn" onclick="authSystem.logout()">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
        </div>
    </header>

    <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
    <main class="main-content">
        <div class="home-container">
            <!-- ãƒšãƒ¼ã‚¸ã‚¿ã‚¤ãƒˆãƒ« -->
            <div class="page-header">
                <h1 class="page-title">ãƒ›ãƒ¼ãƒ </h1>
                <p class="welcome-message" id="welcomeMessage">ãŠç–²ã‚Œæ§˜ã§ã™ï¼æœ¬æ—¥ã‚‚å­¦ç¿’ã‚’é ‘å¼µã‚Šã¾ã—ã‚‡ã†ã€‚</p>
            </div>

            <!-- é€²æ—ã‚µãƒãƒªãƒ¼ -->
            <div class="progress-summary">
                <div class="progress-card">
                    <div class="progress-icon">ğŸ“š</div>
                    <div class="progress-info">
                        <h3>å­¦ç¿’é€²æ—</h3>
                        <div class="progress-stats" id="progressStats">
                            <span class="completed">0</span> / <span class="total">0</span> ãƒãƒ£ãƒ—ã‚¿ãƒ¼å®Œäº†
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚«ãƒ¼ãƒ‰ -->
            <div class="menu-grid">
                <div class="menu-card" onclick="navigateToPage('curriculum.html')">
                    <div class="menu-icon">ğŸ“š</div>
                    <h3>å­¦ç¿’ã‚«ãƒªã‚­ãƒ¥ãƒ©ãƒ </h3>
                    <p>ãƒ¡ã‚¤ãƒ³ã®å­¦ç¿’ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã§ã‚¹ã‚­ãƒ«ã‚¢ãƒƒãƒ—ã‚’ç›®æŒ‡ã—ã¾ã—ã‚‡ã†</p>
                    <div class="menu-arrow">â†’</div>
                </div>

                <div class="menu-card" onclick="navigateToPage('pc-beginner.html')">
                    <div class="menu-icon">ğŸ’»</div>
                    <h3>PCåˆå¿ƒè€…ç”¨ã‚«ãƒªã‚­ãƒ¥ãƒ©ãƒ </h3>
                    <p>ãƒ‘ã‚½ã‚³ãƒ³æ“ä½œã®åŸºç¤ã‹ã‚‰ä¸å¯§ã«å­¦ç¿’ã§ãã¾ã™</p>
                    <div class="menu-arrow">â†’</div>
                </div>

                <div class="menu-card" onclick="navigateToPage('assignment.html')">
                    <div class="menu-icon">ğŸ“</div>
                    <h3>èª²é¡Œæå‡º</h3>
                    <p>å­¦ç¿’èª²é¡Œã®æå‡ºã¨ç¢ºèªãŒã§ãã¾ã™</p>
                    <div class="menu-arrow">â†’</div>
                </div>
            </div>


        </div>
    </main>

    <!-- JavaScriptãƒ•ã‚¡ã‚¤ãƒ« -->
    <script src="js/config.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/progress.js"></script>
    <script src="js/hybrid-progress.js"></script>
    <script>
        // ãƒšãƒ¼ã‚¸å›ºæœ‰ã®JavaScript
        document.addEventListener('DOMContentLoaded', function() {
            // èªè¨¼ãƒã‚§ãƒƒã‚¯
            if (!authSystem.requireAuth()) {
                return;
            }

            // ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã®è¡¨ç¤º
            displayUserInfo();
            
            // é€²æ—æƒ…å ±ã®è¡¨ç¤º
            displayProgressSummary();
            
            // æœ€è¿‘ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ã®è¡¨ç¤º
            displayRecentActivity();
        });

        function displayUserInfo() {
            const currentUser = authSystem.getCurrentUser();
            if (currentUser) {
                const userNameEl = document.getElementById('userName');
                if (userNameEl) {
                    userNameEl.textContent = currentUser.name;
                }

                const welcomeMessage = document.getElementById('welcomeMessage');
                const hour = new Date().getHours();
                let greeting = 'ã“ã‚“ã«ã¡ã¯';
                if (hour < 12) greeting = 'ãŠã¯ã‚ˆã†ã”ã–ã„ã¾ã™';
                else if (hour >= 18) greeting = 'ã“ã‚“ã°ã‚“ã¯';
                
                welcomeMessage.textContent = `${greeting}ã€${currentUser.name}ã•ã‚“ï¼æœ¬æ—¥ã‚‚å­¦ç¿’ã‚’é ‘å¼µã‚Šã¾ã—ã‚‡ã†ã€‚`;
            }
        }

        function displayProgressSummary() {
            const currentUser = authSystem.getCurrentUser();
            if (!currentUser) return;

            const progressKey = `userProgress_${currentUser.userId}`;
            const progress = JSON.parse(localStorage.getItem(progressKey) || '{}');
            
            const completed = progress.completedChapters ? progress.completedChapters.length : 0;
            const total = progress.totalChapters || 0;
            const percentage = total > 0 ? Math.round((completed / total) * 100) : 0;
            
            document.querySelector('#progressStats .completed').textContent = completed;
            document.querySelector('#progressStats .total').textContent = total;
            document.getElementById('progressFill').style.width = percentage + '%';
        }

        function displayRecentActivity() {
            const currentUser = authSystem.getCurrentUser();
            if (!currentUser) return;

            const progressKey = `userProgress_${currentUser.userId}`;
            const progress = JSON.parse(localStorage.getItem(progressKey) || '{}');
            const activityList = document.getElementById('activityList');
            
            // æœ€è¿‘å®Œäº†ã—ãŸãƒãƒ£ãƒ—ã‚¿ãƒ¼ãŒã‚ã‚Œã°è¡¨ç¤º
            if (progress.completedChapters && progress.completedChapters.length > 0) {
                const recentChapter = progress.completedChapters[progress.completedChapters.length - 1];
                const activityHTML = `
                    <div class="activity-item">
                        <div class="activity-icon">âœ…</div>
                        <div class="activity-content">
                            <p class="activity-text">${recentChapter.chapterTitle} ã‚’å®Œäº†ã—ã¾ã—ãŸ</p>
                            <small class="activity-time">${new Date(recentChapter.completedAt).toLocaleDateString('ja-JP')}</small>
                        </div>
                    </div>
                `;
                activityList.innerHTML = activityHTML + activityList.innerHTML;
            }
        }

        function navigateToPage(page) {
            // ãƒšãƒ¼ã‚¸ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³æ™‚ã«ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ã‚’æ›´æ–°
            authSystem.updateLastActivity();
            window.location.href = page;
        }
    </script>
</body>
</html>