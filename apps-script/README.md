# Google Apps Script セットアップ手順

このディレクトリには、LMS進捗管理システムのGoogle Apps Scriptコードが含まれています。

## セットアップ手順

### 1. Google Sheetsの準備

1. Google Driveで新しいスプレッドシートを作成
2. スプレッドシートIDをメモ（URLの`/d/`と`/edit`の間の文字列）
   ```
   例: https://docs.google.com/spreadsheets/d/【ここがID】/edit
   ```

### 2. Apps Scriptのデプロイ

1. スプレッドシートで「拡張機能」→「Apps Script」を選択
2. `Code.gs` の内容をすべてコピーしてエディタに貼り付け
3. 保存（Ctrl+S または Cmd+S）
4. 「デプロイ」→「新しいデプロイ」をクリック
5. 歯車アイコン「種類を選択」→「ウェブアプリ」を選択
6. 以下の設定を行う：
   - **説明**: 「LMS進捗管理システム」
   - **次のユーザーとして実行**: 「自分」
   - **アクセスできるユーザー**: 「全員」
7. 「デプロイ」をクリック
8. 権限の承認を求められたら、「アクセスを承認」をクリック
9. デプロイが完了すると **ウェブアプリのURL** が表示されます
   ```
   例: https://script.google.com/macros/s/【デプロイID】/exec
   ```
10. このURLをメモします

### 3. config.js の設定

1. プロジェクトの `js/config.js` を開く
2. 以下の値を実際の値に置き換える：

```javascript
const CONFIG = {
    // ステップ1でメモしたスプレッドシートID
    SPREADSHEET_ID: 'あなたのスプレッドシートID',

    // ステップ2でメモしたデプロイURL
    APPS_SCRIPT_URL: 'https://script.google.com/macros/s/【あなたのデプロイID】/exec',

    // Google Cloud APIキー（次のステップで設定）
    GOOGLE_API_KEY: 'あなたのAPIキー',

    // その他の設定はそのまま
};
```

### 4. Google Cloud API の有効化

1. [Google Cloud Console](https://console.cloud.google.com/) にアクセス
2. 新しいプロジェクトを作成
3. 「APIとサービス」→「ライブラリ」を選択
4. 「Google Sheets API」を検索して有効化
5. 「認証情報」→「認証情報を作成」→「APIキー」を選択
6. 作成されたAPIキーをコピー
7. `config.js` の `GOOGLE_API_KEY` に貼り付け

### 5. スプレッドシートの共有設定

1. スプレッドシートを開く
2. 右上の「共有」ボタンをクリック
3. 「リンクを知っている全員」に変更
4. 権限を「閲覧者」に設定
5. 「完了」をクリック

## テスト方法

### Apps Scriptのテスト

1. Apps Scriptエディタで `testUpdateProgress` 関数を選択
2. 「実行」ボタンをクリック
3. 「実行ログ」でエラーがないことを確認
4. スプレッドシートに「進捗データ」シートが作成され、テストデータが挿入されていることを確認

### ブラウザからのテスト

1. LMSにログイン（例: user001 / user001）
2. 任意のチャプターを開く
3. 「チャプター完了」ボタンをクリック
4. ブラウザの開発者ツール（F12）→「Console」タブでエラーがないことを確認
5. スプレッドシートに新しい行が追加されていることを確認

## トラブルシューティング

### エラー: 「このアプリは確認されていません」

Apps Scriptのデプロイ時に表示される場合：
1. 「詳細」をクリック
2. 「安全でないページに移動」をクリック
3. 自分のスクリプトなので安全です

### エラー: 「CORS policy」

`config.js` の `APPS_SCRIPT_URL` が正しいか確認してください。

### データがスプレッドシートに保存されない

1. Apps Scriptのデプロイが正しく完了しているか確認
2. 「アクセスできるユーザー」が「全員」になっているか確認
3. ブラウザのConsoleでエラーメッセージを確認

### 同期が動作しない

1. `config.js` の `GOOGLE_API_KEY` が正しいか確認
2. Google Sheets APIが有効化されているか確認
3. スプレッドシートの共有設定が正しいか確認

## セキュリティに関する注意

- **config.js はGitにコミットしないでください**（.gitignoreに追加済み）
- APIキーは他人に共有しないでください
- 本番環境では、より厳格な認証システムの導入を推奨します

## サポート

問題が解決しない場合は、以下を確認してください：
1. ブラウザの開発者ツール（F12）のConsoleタブ
2. Apps Scriptの実行ログ
3. スプレッドシートのシート名が「進捗データ」になっているか
